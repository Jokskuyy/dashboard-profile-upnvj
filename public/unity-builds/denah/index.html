<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>UPN Veteran Jakarta - Campus Map</title>
    <link rel="shortcut icon" href="/logoupnvj.png" />
    <style>
      body {
        padding: 0;
        margin: 0;
        background: #232323;
        font-family: Arial, sans-serif;
      }

      #unity-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      #unity-canvas {
        background: #232323;
        width: 100%;
        height: 100%;
      }

      #unity-loading-bar {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        display: none;
      }

      #unity-logo {
        width: 154px;
        height: 130px;
        background: url("/logoupnvj.png") no-repeat center / contain;
      }

      #unity-progress-bar-empty {
        width: 141px;
        height: 18px;
        margin-top: 10px;
        margin-left: auto;
        margin-right: auto;
        background: url("data:image/gif;base64,R0lGODlhkQAFAPIAAL3L2MjQ2s3T3M7U3dDV3dHW3tLX3wAAACH5BAEKAAkALAAAAACRAAUAAAMgCLrcEj1CYSKnKRw5LQSD0gqHzd35jcYWnsKJJcdnLkQAOw==")
          repeat-x;
      }

      #unity-progress-bar-full {
        width: 0%;
        height: 18px;
        background: url("data:image/gif;base64,R0lGODlhkQAFAPIAAIeozI+tzoKlyoSlyoytzpGuzo2uzgAAACH5BAEKAAkALAAAAACRAAUAAAMhCLrcYDnKFwqnsQVqEECEMsODOYGEZJJpypJWbBnCsQcAOw==")
          repeat-x;
      }

      #unity-footer {
        position: relative;
        padding: 10px;
        color: white;
        text-align: center;
        background: rgba(0, 0, 0, 0.7);
      }

      .unity-desktop #unity-footer {
        display: none;
      }

      .unity-mobile #unity-footer {
        display: block;
      }

      #unity-fullscreen-button {
        float: right;
        width: 38px;
        height: 38px;
        background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==")
          no-repeat center;
      }

      .error-message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        text-align: center;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        max-width: 400px;
      }
    </style>
  </head>
  <body>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-footer">
        <div id="unity-fullscreen-button"></div>
      </div>
    </div>

    <script>
      // Unity WebGL Build Configuration
      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");

      // Show loading bar when starting
      loadingBar.style.display = "block";

      var buildUrl = "./Build";
      var loaderUrl = buildUrl + "/denah.loader.js";
      var config = {
        dataUrl: buildUrl + "/denah.data",
        frameworkUrl: buildUrl + "/denah.framework.js",
        codeUrl: buildUrl + "/denah.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "UPN Veteran Jakarta",
        productName: "Campus Map",
        productVersion: "1.0",
        showBanner: function () {},
      };

      // Adjust canvas size
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
        config.matchWebGLToCanvasSize = false;
      } else {
        canvas.style.width = "100%";
        canvas.style.height = "100%";
      }

      canvas.style.background = "url('./logo.jpg') center / cover";

      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        })
          .then((unityInstance) => {
            window.unityInstance = unityInstance;
            loadingBar.style.display = "none";

            fullscreenButton.onclick = () => {
              unityInstance.SetFullscreen(1);
            };
          })
          .catch((message) => {
            console.error("Unity WebGL failed to load:", message);
            loadingBar.style.display = "none";

            // Show error message
            var errorDiv = document.createElement("div");
            errorDiv.className = "error-message";
            errorDiv.innerHTML = `
                    <h3>Unity WebGL Campus Map</h3>
                    <p>Unable to load the 3D campus map.</p>
                    <p><strong>Setup Required:</strong></p>
                    <ol style="text-align: left; margin: 10px 0;">
                        <li>Build Unity project for WebGL platform</li>
                        <li>Copy build files to public/unity-builds/denah/Build/</li>
                        <li>Ensure all .data, .framework.js, and .wasm files are present</li>
                    </ol>
                    <p style="font-size: 12px; opacity: 0.7;">Current APK file needs to be converted to WebGL build</p>
                    <button onclick="window.history.back()" style="margin-top: 10px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Go Back
                    </button>
                `;
            container.appendChild(errorDiv);
          });
      };

      script.onerror = () => {
        console.error("Failed to load Unity WebGL loader");
        loadingBar.style.display = "none";

        var errorDiv = document.createElement("div");
        errorDiv.className = "error-message";
        errorDiv.innerHTML = `
                <h3>Unity WebGL Not Available</h3>
                <p>The Unity WebGL build files are missing.</p>
                <p>Please convert the APK to WebGL build and place files in:</p>
                <code style="background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px;">/public/unity-builds/denah/Build/</code>
                <button onclick="window.history.back()" style="margin-top: 15px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Go Back
                </button>
            `;
        container.appendChild(errorDiv);
      };

      document.head.appendChild(script);
    </script>
  </body>
</html>
